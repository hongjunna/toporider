services:
  # ğŸ‘‡ ìƒˆë¡œ ì¶”ê°€í•  DB ì„œë¹„ìŠ¤
  db:
    image: postgres:15
    container_name: postgres_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=admin
      - POSTGRES_PASSWORD=wnsfoq1!
      - POSTGRES_DB=toporider_db
    ports:
      # [ìˆ˜ì •] ì™¼ìª½(5401)ì€ ë‚´ ì»´í“¨í„°ìš©, ì˜¤ë¥¸ìª½(5432)ì€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ìš©
      - '5401:5432'
    networks:
      - toporider_net

  backend:
    build: ./backend
    container_name: fastapi_backend
    ports:
      - '8000:8000'
    depends_on:
      - graphhopper
      - db
    environment:
      - GRAPHHOPPER_URL=http://graphhopper:8989
      # [ì¤‘ìš”] ë°±ì—”ë“œëŠ” ë‚´ë¶€ë§ì„ ì“°ë¯€ë¡œ í¬íŠ¸ëŠ” 5432ì—¬ì•¼ í•©ë‹ˆë‹¤!
      # ë¹„ë°€ë²ˆí˜¸ ì˜¤íƒ€ë„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤ (wnsfqo1! -> wnsfoq1!)
      - DATABASE_URL=postgresql://admin:wnsfoq1!@db:5432/toporider_db
    networks:
      - toporider_net

  graphhopper:
    build: ./graphhopper
    container_name: graphhopper
    volumes:
      - ./data:/data
      - ./graphhopper/config-gh.yml:/graphhopper/config.yml
    environment:
      - JAVA_OPTS=-Xmx2g -Xms2g
    ports:
      - '8989:8989'
    networks:
      - toporider_net

  frontend:
    build: ./frontend
    container_name: toporider_frontend
    restart: always
    ports:
      - '3000:80' # í˜¸ìŠ¤íŠ¸ì˜ 3000ë²ˆ í¬íŠ¸ë¡œ ì—°ê²°
    depends_on:
      - backend
    networks:
      - toporider_net

volumes: # ë§¨ ì•„ë˜ì— ì¶”ê°€
  postgres_data:

networks:
  toporider_net:
    driver: bridge

